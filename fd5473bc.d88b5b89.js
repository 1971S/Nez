(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{106:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return c})),t.d(n,"default",(function(){return s}));var o=t(3),r=t(7),a=(t(0),t(111)),i={id:"Pooling",title:"Pooling"},l={unversionedId:"features/Utils/Pooling",id:"features/Utils/Pooling",isDocsHomePage:!1,title:"Pooling",description:"When building Games, you often use objects that are quite expensive to create and clean up (GC). These costs can be high enough to affect the game's performance. Nez offers the ObjectPool and ListPool to solve this.",source:"@site/docs\\features\\Utils\\Pooling.md",slug:"/features/Utils/Pooling",permalink:"/Nez/docs/features/Utils/Pooling",editUrl:"https://github.com/prime31/Nez/edit/master/Nez.github.io/docs/features/Utils/Pooling.md",version:"current",sidebar:"someSidebar",previous:{title:"Collections",permalink:"/Nez/docs/features/Utils/Collections"},next:{title:"Deferred Lighting",permalink:"/Nez/docs/features/Graphics/Lighting/DeferredLighting"}},c=[{value:"Example",id:"example",children:[]},{value:"Extra",id:"extra",children:[{value:"<code>Pool&lt;&gt;.ClearCache</code>",id:"poolclearcache",children:[]},{value:"<code>Pool&lt;&gt;.WarmCache</code>",id:"poolwarmcache",children:[]},{value:"<code>Pool&lt;&gt;.TrimCache</code>",id:"pooltrimcache",children:[]}]}],d={toc:c};function s(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},d,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("p",null,"When building Games, you often use objects that are quite expensive to create and clean up (GC). These costs can be high enough to affect the game's performance. Nez offers the ObjectPool and ListPool to solve this."),Object(a.b)("p",null,"An Object pool is a container of objects that contains a list of objects that are ready to be used. Once an object is taken out of the pool, it is no longer available in the pool until it is put back in."),Object(a.b)("h1",{id:"pool"},"Pool"),Object(a.b)("h2",{id:"example"},"Example"),Object(a.b)("p",null,"As an example to show how you can use a ",Object(a.b)("inlineCode",{parentName:"p"},"Pool"),", I created a simple tree that retrieves its nodes from a ",Object(a.b)("inlineCode",{parentName:"p"},"Pool"),"."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-cs"},"class SomeNode : IPoolable\n{\n    public static int InstanceCount = 0;\n\n    public SomeNode()\n    {\n        InstanceCount++;\n    }\n\n    public int Value;\n\n    public SomeNode Left;\n    public SomeNode Right;\n\n    public void Reset()\n    {\n        Value = default;\n        Left = default;\n        Right = default;\n    }\n}\n")),Object(a.b)("p",null,"As you can see in the code above, ",Object(a.b)("inlineCode",{parentName:"p"},"SomeNode")," inherits ",Object(a.b)("inlineCode",{parentName:"p"},"IPoolable"),".\nIPoolable is an interface used by the pool to reset the object. It is not mandatory to implement this, but it can be useful."),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"InstanceCount")," is used to find out how many instances have been created."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-cs"},'class SomeTree\n{\n    private SomeNode _root;\n\n    public void Add(int value)\n    {\n        Add(ref _root, value);\n    }\n\n    public void Clear()\n    {\n        foreach (SomeNode someNode in GetNodes(_root))\n        {\n            Pool<SomeNode>.Free(someNode);\n        }\n    }\n\n    private void Add(ref SomeNode node, int value)\n    {\n        if (node == null)\n        {\n            node = Pool<SomeNode>.Obtain();\n            node.Value = value;\n        }\n        if (value > node.Value)\n        {\n            Add(ref node.Right, value);\n        }\n        if (value < node.Value)\n        {\n            Add(ref node.Left, value);\n        }\n    }\n\n    private IEnumerable<SomeNode> GetNodes(SomeNode node)\n    {\n        if (node == null)\n            yield break;\n        \n        foreach (SomeNode leftNode in GetNodes(node.Left))\n        {\n            yield return leftNode;\n        }\n        foreach (SomeNode rightNode in GetNodes(node.Right))\n        {\n            yield return rightNode;\n        }\n        yield return node;\n    }\n\n    public override string ToString()\n    {\n        return string.Join(",", GetNodes(_root).Select(x => x.Value));\n    }\n}\n')),Object(a.b)("p",null,"The tree uses the ",Object(a.b)("inlineCode",{parentName:"p"},"Pool")," in the ",Object(a.b)("inlineCode",{parentName:"p"},"Clear")," and ",Object(a.b)("inlineCode",{parentName:"p"},"void Add(ref SomeNode node, int value)")," methods."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-cs"},'SomeTree firstTree = new SomeTree();\nfirstTree.Add(3);\nfirstTree.Add(2);\nfirstTree.Add(4);\nfirstTree.Add(5);\nfirstTree.Add(1);\nstring firstResult = firstTree.ToString(); // "1,2,5,4,3"\nSystem.Console.WriteLine(SomeNode.InstanceCount); // 5\n')),Object(a.b)("p",null,"After creating the tree, 5 nodes were instantiated."),Object(a.b)("p",null,"With the ",Object(a.b)("inlineCode",{parentName:"p"},"Clear")," method we put them back into the pool."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-cs"},"// Free Nodes to pool\nfirstTree.Clear();\n")),Object(a.b)("p",null,"Then we create a new tree."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-cs"},'SomeTree secondTree = new SomeTree();\nsecondTree.Add(8);\nsecondTree.Add(7);\nsecondTree.Add(4);\nsecondTree.Add(2);\nsecondTree.Add(3);\nstring secondResult = secondTree.ToString(); // "3,2,4,7,8"\nSystem.Console.WriteLine(SomeNode.InstanceCount); // 5\n')),Object(a.b)("p",null,"no new nodes were created because they where reused from the pool."),Object(a.b)("h2",{id:"extra"},"Extra"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"Pool")," also has a few features that were not present in the example."),Object(a.b)("h3",{id:"poolclearcache"},Object(a.b)("inlineCode",{parentName:"h3"},"Pool<>.ClearCache")),Object(a.b)("p",null,"Removes all pooled items."),Object(a.b)("h3",{id:"poolwarmcache"},Object(a.b)("inlineCode",{parentName:"h3"},"Pool<>.WarmCache")),Object(a.b)("p",null,"Add instances to the pool."),Object(a.b)("h3",{id:"pooltrimcache"},Object(a.b)("inlineCode",{parentName:"h3"},"Pool<>.TrimCache")),Object(a.b)("p",null,"Removes items from the pool until the pool is at the desired trim size."),Object(a.b)("h1",{id:"listpool"},"ListPool"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"ListPool")," works the same as ",Object(a.b)("inlineCode",{parentName:"p"},"Pool"),", except that the list is automatically emptied by the ",Object(a.b)("inlineCode",{parentName:"p"},"Free")," method."))}s.isMDXComponent=!0},111:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return m}));var o=t(0),r=t.n(o);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=r.a.createContext({}),s=function(e){var n=r.a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=s(e.components);return r.a.createElement(d.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},b=r.a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),u=s(t),b=o,m=u["".concat(i,".").concat(b)]||u[b]||p[b]||a;return t?r.a.createElement(m,l(l({ref:n},d),{},{components:t})):r.a.createElement(m,l({ref:n},d))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=b;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var d=2;d<a;d++)i[d]=t[d];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);